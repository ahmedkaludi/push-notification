var config=pnScriptSetting.pn_config;if(firebase.apps.length||firebase.initializeApp(config),firebase.analytics(),!messaging)var messaging=firebase.messaging();function pushnotification_load_messaging(){messaging.onTokenRefresh((()=>{messaging.getToken().then((e=>{console.log("Token refreshed."),push_notification_setTokenSentToServer(!1),sendTokenToServer(e),resetUI()})).catch((e=>{console.log("Unable to retrieve refreshed token ",e),showToken("Unable to retrieve refreshed token ",e)}))})),addEventListener("load",(function(){if(null==function(e){for(var n=null,t=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var a=o[i];" "==a.charAt(0);)a=a.substring(1,a.length);0==a.indexOf(t)&&(n=a.substring(t.length,a.length))}return null===n&&localStorage.getItem(e)&&localStorage.getItem(e+"_expiry")>Date.now()&&(n=localStorage.getItem(e)),n}("pn_notification_block")){if(window.history.length<pnScriptSetting.popup_show_afternpageview)return!1;var e=document.getElementsByClassName("pn-wrapper");setTimeout((function(){e&&(e[0].style.display="flex")}),pnScriptSetting.notification_popup_show_afternseconds)}document.getElementById("pn-activate-permission_link_nothanks").addEventListener("click",(function(){var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime());var n=document.getElementsByClassName("pn-wrapper");n&&(n[0].style.display="none")})),document.getElementById("pn-activate-permission_link").addEventListener("click",(function(){var e=document.getElementsByClassName("pn-wrapper");e&&(e[0].style.display="none"),messaging.requestPermission().then((function(){console.log("Notification permission granted.");var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,document.cookie="notification_permission=granted;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime()),localStorage.getItem("notification_permission","granted"),push_notification_isTokenSentToServer()?console.log("Token already saved"):push_notification_getRegToken()})).catch((function(e){if(Notification&&"denied"==Notification.permission){console.log("Notification permission denied.");var n=new Date;n.setDate(n.getDate()+pnScriptSetting.notification_popup_show_again),document.cookie="pn_notification_block=true;expires="+n+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",n.getTime())}else console.log("Unable to get permission to notify.",e)}))}))})),messaging.onMessage((function(e){console.log("Message received. ",e),notificationTitle=e.data.title,notificationOptions={body:e.data.body,icon:e.data.icon,image:e.data.image,vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primarykey:e.data.currentCampaign,url:e.data.url}};var n=new Notification(notificationTitle,notificationOptions);n.onclick=function(t){t.preventDefault(),window.open(e.data.url,"_blank");var o=new XMLHttpRequest;o.open("POST",pnScriptSetting.ajax_url,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send("campaign="+e.data.currentCampaign+"&nonce="+pnScriptSetting.nonce+"&action=pn_noteclick_subscribers"),n.close()}})),navigator.clearAppBadge?navigator.clearAppBadge():navigator.clearExperimentalAppBadge?navigator.clearExperimentalAppBadge():window.ExperimentalBadge&&window.ExperimentalBadge.clear()}function push_notification_getRegToken(e){messaging.getToken().then((function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))})).catch((function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)}))}function push_notification_setTokenSentToServer(e){window.localStorage.setItem("sentToServer",e?"1":"0")}function push_notification_isTokenSentToServer(){return"1"===window.localStorage.getItem("sentToServer")}function sendTokenToServer(e){push_notification_isTokenSentToServer()?console.log("Token already sent to server so won't send it again unless it changes"):(console.log("Sending token to server..."),push_notification_saveToken(e))}function pn_get_checket_cats(e,n){e.checked&&pn_cat_value.push(e.checked)}function push_notification_saveToken(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(200==this.responseText.status&&push_notification_setTokenSentToServer(!0),console.log(this.responseText))};const t=[],o=document.querySelectorAll("#pn-categories-checkboxes input:checked");for(var i=0;i<=o.length-1;i++)t.push(o[i].value);var a=[...t].join(","),r=pushnotificationFCMGetOS(),s=pushnotificationFCMbrowserclientDetector(),c=window.location.href;n.open("POST",pnScriptSetting.ajax_url,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("token_id="+e+"&category="+a+"&user_agent="+s+"&os="+r+"&nonce="+pnScriptSetting.nonce+"&action=pn_register_subscribers&url="+c)}pushnotification_load_messaging();var pushnotificationFCMbrowserclientDetector=function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,n="undefined"!=typeof InstallTrigger,t=/constructor/i.test(window.HTMLElement)||(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),o=!!document.documentMode,i=!o&&!!window.StyleMedia,a=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime),r=(a||e)&&!!window.CSS;if(navigator.userAgent.match("CriOS"))return"Chrome ios";t=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);var s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return t&&s?"Safari ios":t?"Safari":n?"Firefox":a?"Chrome":e?"Opera":o?"IE":i?"Edge":r?"Blink":void 0},pushnotificationFCMGetOS=function(){var e=window.navigator.userAgent,n=window.navigator.platform,t=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(n)?t="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(n)?t="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?t="Windows":/Android/.test(e)?t="Android":!t&&/Linux/.test(n)&&(t="Linux"),t};"0"==pnScriptSetting.pn_token_exists&&setTimeout((function(){messaging.getToken().then((function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))})).catch((function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)}))}),2e3);