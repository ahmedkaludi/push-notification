var config=pnScriptSetting.pn_config;if(firebase.apps.length||firebase.initializeApp(config),firebase.analytics(),!messaging)var messaging=firebase.messaging();function pushnotification_load_messaging(){messaging.onTokenRefresh((()=>{messaging.getToken().then((e=>{console.log("Token refreshed."),push_notification_setTokenSentToServer(!1),sendTokenToServer(e),resetUI()})).catch((e=>{console.log("Unable to retrieve refreshed token ",e),showToken("Unable to retrieve refreshed token ",e)}))})),addEventListener("load",(function(){if(null==function(e){for(var t=null,n=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var a=o[i];" "==a.charAt(0);)a=a.substring(1,a.length);0==a.indexOf(n)&&(t=a.substring(n.length,a.length))}return null===t&&localStorage.getItem(e)&&localStorage.getItem(e+"_expiry")>Date.now()&&(t=localStorage.getItem(e)),t}("pn_notification_block")){if(window.history.length<pnScriptSetting.popup_show_afternpageview)return!1;if("1"==pnScriptSetting.superpwa_apk_only){if("apk"!=sessionStorage.getItem("superpwa_mode"))return!1}if("1"==pnScriptSetting.pwaforwp_apk_only){if("apk"!=sessionStorage.getItem("pwaforwp_mode"))return!1}var e=1e3;pnScriptSetting.popup_show_afternseconds&&(e=1e3*parseInt(pnScriptSetting.popup_show_afternseconds)),setTimeout((function(){var e=document.getElementsByClassName("pn-wrapper");e.length>0&&(e[0].style.display="flex")}),e)}document.getElementById("pn-activate-permission_link_nothanks")&&document.getElementById("pn-activate-permission_link_nothanks").addEventListener("click",(function(){var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime());var t=document.getElementsByClassName("pn-wrapper");t&&(t[0].style.display="none")}));document.getElementById("pn-activate-permission_link")&&document.getElementById("pn-activate-permission_link").addEventListener("click",(function(){var e=document.getElementsByClassName("pn-wrapper");e&&(e[0].style.display="none"),messaging.requestPermission().then((function(){console.log("Notification permission granted.");var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,document.cookie="notification_permission=granted;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime()),localStorage.getItem("notification_permission","granted"),push_notification_isTokenSentToServer()?console.log("Token already saved"):push_notification_getRegToken()})).catch((function(e){if(Notification&&"denied"==Notification.permission){console.log("Notification permission denied.");var t=new Date;t.setDate(t.getDate()+pnScriptSetting.notification_popup_show_again),document.cookie="pn_notification_block=true;expires="+t+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",t.getTime())}else console.log("Unable to get permission to notify.",e)}))}))})),messaging.onMessage((function(e){console.log("Message received. ",e),notificationTitle=e.data.title,notificationOptions={body:e.data.body,icon:e.data.icon,image:e.data.image,vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primarykey:e.data.currentCampaign,url:e.data.url}};var t=new Notification(notificationTitle,notificationOptions);t.onclick=function(n){n.preventDefault(),window.open(e.data.url,"_blank");var o=new XMLHttpRequest;o.open("POST",pnScriptSetting.ajax_url,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send("campaign="+e.data.currentCampaign+"&nonce="+pnScriptSetting.nonce+"&action=pn_noteclick_subscribers"),t.close()}})),navigator.clearAppBadge?navigator.clearAppBadge():navigator.clearExperimentalAppBadge?navigator.clearExperimentalAppBadge():window.ExperimentalBadge&&window.ExperimentalBadge.clear()}function push_notification_getRegToken(e){messaging.getToken().then((function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))})).catch((function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)}))}function push_notification_setTokenSentToServer(e){window.localStorage.setItem("sentToServer",e?"1":"0")}function push_notification_isTokenSentToServer(){return"1"===window.localStorage.getItem("sentToServer")}function sendTokenToServer(e){push_notification_isTokenSentToServer()?console.log("Token already sent to server so won't send it again unless it changes"):(console.log("Sending token to server..."),push_notification_saveToken(e))}function pn_get_checket_cats(e,t){e.checked&&pn_cat_value.push(e.checked)}function push_notification_saveToken(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==this.readyState&&200==this.status&&(200==this.responseText.status&&push_notification_setTokenSentToServer(!0),console.log(this.responseText))};var n=pnScriptSetting.auto_segment_enabled||!1,o=[],i=[];if(console.log("Auto-segment enabled:",n),console.log("Auto categories:",pnScriptSetting.auto_categories),console.log("Auto authors:",pnScriptSetting.auto_authors),n)o=pnScriptSetting.auto_categories||[],i=pnScriptSetting.auto_authors||[],console.log("Using auto data - categories:",o,"authors:",i);else{const e=document.querySelectorAll("#pn-categories-checkboxes input:checked");for(var a=0;a<=e.length-1;a++)o.push(e[a].value);const t=document.querySelectorAll("#pn-author-checkboxes input:checked");for(a=0;a<=t.length-1;a++)i.push(t[a].value);console.log("Using manual selection - categories:",o,"authors:",i)}var r=[...i].join(","),s=[...o].join(",");console.log("Final category string:",s),console.log("Final author string:",r);var c=pushnotificationFCMGetOS(),p=pushnotificationFCMbrowserclientDetector(),l=window.location.href;t.open("POST",pnScriptSetting.ajax_url,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("token_id="+e+"&category="+s+"&author="+r+"&user_agent="+p+"&os="+c+"&nonce="+pnScriptSetting.nonce+"&action=pn_register_subscribers&url="+l)}pushnotification_load_messaging();var pushnotificationFCMbrowserclientDetector=function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,n=/constructor/i.test(window.HTMLElement)||(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),o=!!document.documentMode,i=!o&&!!window.StyleMedia,a=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime),r=(a||e)&&!!window.CSS;if(navigator.userAgent.match("CriOS"))return"Chrome ios";n=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);var s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return n&&s?"Safari ios":n?"Safari":t?"Firefox":a?"Chrome":e?"Opera":o?"IE":i?"Edge":r?"Blink":void 0},pushnotificationFCMGetOS=function(){var e=window.navigator.userAgent,t=window.navigator.platform,n=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?n="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(t)?n="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?n="Windows":/Android/.test(e)?n="Android":!n&&/Linux/.test(t)&&(n="Linux"),n};"0"==pnScriptSetting.pn_token_exists&&setTimeout((function(){messaging.getToken().then((function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))})).catch((function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)}))}),2e3),setTimeout((function(){if(document.querySelector(".pn-bell-button")){document.querySelector(".pn-bell-button").addEventListener("click",(()=>{document.cookie="pn_notification_block=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.removeItem("pn_notification_block"),location.reload()}))}}),2e3);