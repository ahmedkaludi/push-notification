var config=pnScriptSetting.pn_config;firebase.apps.length||firebase.initializeApp(config);var swsource=pnScriptSetting.swsource;const messaging=firebase.messaging();function pushnotification_load_messaging(e){if(messaging.onTokenRefresh(()=>{messaging.getToken().then(e=>{console.log("Token refreshed."),push_notification_setTokenSentToServer(!1),sendTokenToServer(e),resetUI()}).catch(e=>{console.log("Unable to retrieve refreshed token ",e),showToken("Unable to retrieve refreshed token ",e)})}),null==function e(n){for(var t=null,o=n+"=",i=document.cookie.split(";"),r=0;r<i.length;r++){for(var a=i[r];" "==a.charAt(0);)a=a.substring(1,a.length);0==a.indexOf(o)&&(t=a.substring(o.length,a.length))}return null===t&&localStorage.getItem(n)&&localStorage.getItem(n+"_expiry")>Date.now()&&(t=localStorage.getItem(n)),t}("pn_notification_block")){let n=window.history.length;if(n<pnScriptSetting.popup_show_afternpageview)return!1;var t=document.getElementsByClassName("pn-wrapper");setTimeout(function(){t&&(t[0].style.display="flex")},pnScriptSetting.notification_popup_show_afternseconds)}document.getElementById("pn-activate-permission_link_nothanks").addEventListener("click",function(){var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime());var n=document.getElementsByClassName("pn-wrapper");n&&(n[0].style.display="none")}),document.getElementById("pn-activate-permission_link").addEventListener("click",function(){var e=document.getElementsByClassName("pn-wrapper");e&&(e[0].style.display="none"),messaging.requestPermission().then(function(){console.log("Notification permission granted.");var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,document.cookie="notification_permission=granted;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime()),localStorage.getItem("notification_permission","granted"),push_notification_isTokenSentToServer()?console.log("Token already saved"):push_notification_getRegToken()}).catch(function(e){if(Notification&&"denied"==Notification.permission){console.log("Notification permission denied.");var n=new Date;n.setDate(n.getDate()+pnScriptSetting.notification_popup_show_again),document.cookie="pn_notification_block=true;expires="+n+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",n.getTime())}else console.log("Unable to get permission to notify.",e)})}),messaging.onMessage(function(n){console.log("Message received. ",n);let t=n.data.title,o={body:n.data.body,icon:n.data.icon,image:n.data.image,vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primarykey:n.data.currentCampaign,url:n.data.url}};e.showNotification(t,o)}),navigator.clearAppBadge?navigator.clearAppBadge():navigator.clearExperimentalAppBadge?navigator.clearExperimentalAppBadge():window.ExperimentalBadge&&window.ExperimentalBadge.clear()}function push_notification_getRegToken(e){messaging.getToken().then(function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))}).catch(function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)})}function push_notification_setTokenSentToServer(e){window.localStorage.setItem("sentToServer",e?"1":"0")}function push_notification_isTokenSentToServer(){return"1"===window.localStorage.getItem("sentToServer")}function sendTokenToServer(e){push_notification_isTokenSentToServer()?console.log("Token already sent to server so won't send it again unless it changes"):(console.log("Sending token to server..."),push_notification_saveToken(e))}function pn_get_checket_cats(e,n){e.checked&&pn_cat_value.push(e.checked)}function push_notification_saveToken(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(200==this.responseText.status&&push_notification_setTokenSentToServer(!0),console.log(this.responseText))};let t=[],o=document.querySelectorAll("#pn-categories-checkboxes input:checked");for(var i=0;i<=o.length-1;i++)t.push(o[i].value);var r=[...t].join(","),a=pushnotificationFCMGetOS(),s=pushnotificationFCMbrowserclientDetector(),c=window.location.href;n.open("POST",pnScriptSetting.ajax_url,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("token_id="+e+"&category="+r+"&user_agent="+s+"&os="+a+"&nonce="+pnScriptSetting.nonce+"&action=pn_register_subscribers&url="+c)}window.addEventListener("load",function(){"serviceWorker"in navigator?navigator.serviceWorker.register(swsource,{scope:pnScriptSetting.scope}).then(function(e){messaging.useServiceWorker(e),pushnotification_load_messaging(e),console.log("Congratulations!!Service Worker Registered ServiceWorker scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)}):console.log("Pushnotification not supported ")}),firebase.analytics();var pushnotificationFCMbrowserclientDetector=function(){var e,n="",t=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,o="undefined"!=typeof InstallTrigger,i=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(e=!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),r=!!document.documentMode,a=!r&&!!window.StyleMedia,s=!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime),c=(s||t)&&!!window.CSS;if(navigator.userAgent.match("CriOS"))return"Chrome ios";var i=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/),p=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(i&&p)return"Safari ios";if(i)return"Safari";if(o)return"Firefox";if(s)return"Chrome";if(t)return"Opera";else if(r)return"IE";else if(a)return"Edge";else if(c)return"Blink"},pushnotificationFCMGetOS=function(){var e=window.navigator.userAgent,n=window.navigator.platform,t=null;return -1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(n)?t="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(n)?t="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?t="Windows":/Android/.test(e)?t="Android":!t&&/Linux/.test(n)&&(t="Linux"),t};"0"==pnScriptSetting.pn_token_exists&&setTimeout(function(){messaging.getToken().then(function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))}).catch(function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)})},2e3);