var config=pnScriptSetting.pn_config;firebase.apps.length||firebase.initializeApp(config);var swsource=pnScriptSetting.swsource;const messaging=firebase.messaging();window.addEventListener("load",(function(){"serviceWorker"in navigator?navigator.serviceWorker.register(swsource,{scope:pnScriptSetting.scope}).then((function(e){messaging.useServiceWorker(e),pushnotification_load_messaging(e),console.log("Congratulations!!Service Worker Registered ServiceWorker scope: ",e.scope)})).catch((function(e){console.log("ServiceWorker registration failed: ",e)})):console.log("Pushnotification not supported ")}));var pnServiceWorkerRegistration=null;function pushnotification_load_messaging(e){if(pnServiceWorkerRegistration=e,messaging.onTokenRefresh((()=>{messaging.getToken().then((e=>{console.log("Token refreshed."),push_notification_setTokenSentToServer(!1),sendTokenToServer(e),resetUI()})).catch((e=>{console.log("Unable to retrieve refreshed token ",e),showToken("Unable to retrieve refreshed token ",e)}))})),null==function(e){for(var o=null,n=e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){for(var r=t[i];" "==r.charAt(0);)r=r.substring(1,r.length);0==r.indexOf(n)&&(o=r.substring(n.length,r.length))}return null===o&&localStorage.getItem(e)&&localStorage.getItem(e+"_expiry")>Date.now()&&(o=localStorage.getItem(e)),o}("pn_notification_block")){if(window.history.length<pnScriptSetting.popup_show_afternpageview)return!1;pnScriptSetting.popup_show_afternseconds&&1e3*parseInt(pnScriptSetting.popup_show_afternseconds);var o=document.getElementsByClassName("pn-wrapper");setTimeout((function(){o&&o[0]&&(o[0].style.display="flex")}),pnScriptSetting.popup_show_afternseconds)}document.getElementById("pn-activate-permission_link_nothanks").addEventListener("click",(function(){var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime());var o=document.getElementsByClassName("pn-wrapper");o&&(o[0].style.display="none")})),document.getElementById("pn-activate-permission_link").addEventListener("click",(function(){var e=document.getElementsByClassName("pn-wrapper");e&&(e[0].style.display="none"),messaging.requestPermission().then((function(){console.log("Notification permission granted.");var e=new Date;e.setDate(e.getDate()+parseInt(pnScriptSetting.notification_popup_show_again)),document.cookie="pn_notification_block=true;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,document.cookie="notification_permission=granted;expires="+e.toUTCString()+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",e.getTime()),localStorage.getItem("notification_permission","granted"),push_notification_isTokenSentToServer()?console.log("Token already saved"):push_notification_getRegToken()})).catch((function(e){if(Notification&&"denied"==Notification.permission){console.log("Notification permission denied.");var o=new Date;o.setDate(o.getDate()+pnScriptSetting.notification_popup_show_again),document.cookie="pn_notification_block=true;expires="+o+";path="+pnScriptSetting.cookie_scope,localStorage.setItem("pn_notification_block",!0),localStorage.setItem("pn_notification_block_expiry",o.getTime())}else console.log("Unable to get permission to notify.",e)}))})),messaging.onMessage((function(e){console.log("Message received (foreground). ",e);let o=e.data.title,n={body:e.data.body,icon:e.data.icon,image:e.data.image,vibrate:[100,50,100],tag:"pn-"+(e.data.currentCampaign||Date.now()),data:{dateOfArrival:Date.now(),primarykey:e.data.currentCampaign,currentCampaign:e.data.currentCampaign,url:e.data.url||e.data.click_url}};pnServiceWorkerRegistration?pnServiceWorkerRegistration.showNotification(o,n).then((function(){console.log("PN Success (foreground): Notification shown via service worker")})).catch((function(e){console.error("PN Error (foreground): Failed to show notification via service worker",e),navigator.serviceWorker.ready.then((function(e){return e.showNotification(o,n)})).catch((function(e){console.error("PN Error (foreground): Fallback also failed",e)}))})):navigator.serviceWorker.ready.then((function(e){return e.showNotification(o,n)})).then((function(){console.log("PN Success (foreground): Notification shown via service worker (fallback)")})).catch((function(e){console.error("PN Error (foreground): Failed to show notification",e)}))})),navigator.clearAppBadge?navigator.clearAppBadge():navigator.clearExperimentalAppBadge?navigator.clearExperimentalAppBadge():window.ExperimentalBadge&&window.ExperimentalBadge.clear()}function push_notification_getRegToken(e){messaging.getToken().then((function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))})).catch((function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)}))}function push_notification_setTokenSentToServer(e){window.localStorage.setItem("sentToServer",e?"1":"0")}function push_notification_isTokenSentToServer(){return"1"===window.localStorage.getItem("sentToServer")}function sendTokenToServer(e){push_notification_isTokenSentToServer()?console.log("Token already sent to server so won't send it again unless it changes"):(console.log("Sending token to server..."),push_notification_saveToken(e))}function pn_get_checket_cats(e,o){e.checked&&pn_cat_value.push(e.checked)}function push_notification_saveToken(e){var o=new XMLHttpRequest;o.onreadystatechange=function(){4==this.readyState&&200==this.status&&(200==this.responseText.status&&push_notification_setTokenSentToServer(!0),console.log(this.responseText))};var n=pnScriptSetting.auto_segment_enabled||!1,t=[],i=[];if(console.log("Auto-segment enabled:",n),console.log("Auto categories:",pnScriptSetting.auto_categories),console.log("Auto authors:",pnScriptSetting.auto_authors),n)t=pnScriptSetting.auto_categories||[],i=pnScriptSetting.auto_authors||[],console.log("Using auto data - categories:",t,"authors:",i);else{const e=document.querySelectorAll("#pn-categories-checkboxes input:checked");for(var r=0;r<=e.length-1;r++)t.push(e[r].value);const o=document.querySelectorAll("#pn-author-checkboxes input:checked");for(r=0;r<=o.length-1;r++)i.push(o[r].value);console.log("Using manual selection - categories:",t,"authors:",i)}var a=[...i].join(","),s=[...t].join(",");console.log("Final category string:",s),console.log("Final author string:",a);var c=pushnotificationFCMGetOS(),g=pushnotificationFCMbrowserclientDetector(),l=window.location.href;o.open("POST",pnScriptSetting.ajax_url,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send("token_id="+e+"&category="+s+"&author="+a+"&user_agent="+g+"&os="+c+"&nonce="+pnScriptSetting.nonce+"&action=pn_register_subscribers&url="+l)}var pushnotificationFCMbrowserclientDetector=function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,o="undefined"!=typeof InstallTrigger,n=/constructor/i.test(window.HTMLElement)||(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),t=!!document.documentMode,i=!t&&!!window.StyleMedia,r=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime),a=(r||e)&&!!window.CSS;if(navigator.userAgent.match("CriOS"))return"Chrome ios";n=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);var s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return n&&s?"Safari ios":n?"Safari":o?"Firefox":r?"Chrome":e?"Opera":t?"IE":i?"Edge":a?"Blink":void 0},pushnotificationFCMGetOS=function(){var e=window.navigator.userAgent,o=window.navigator.platform,n=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(o)?n="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(o)?n="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(o)?n="Windows":/Android/.test(e)?n="Android":!n&&/Linux/.test(o)&&(n="Linux"),n};"0"==pnScriptSetting.pn_token_exists&&setTimeout((function(){messaging.getToken().then((function(e){e?(push_notification_saveToken(e),console.log(e),push_notification_setTokenSentToServer(!0)):(console.log("No Instance ID token available. Request permission to generate one."),push_notification_setTokenSentToServer(!1))})).catch((function(e){console.log("An error occurred while retrieving token. ",e),push_notification_setTokenSentToServer(!1)}))}),2e3);