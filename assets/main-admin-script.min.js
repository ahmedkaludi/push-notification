function pnCsvToArray(e,t=","){const n=e.slice(0,e.indexOf("\n")).trim().split(t);return e.slice(e.indexOf("\n")+1).split("\n").map((function(e){const i=e.split(t);return n.reduce((function(e,t,n){if(i[n])return e[t]=i[n].trim(),e}),{})}))}function pn_for_wp_select2(){var e=jQuery(".pn_category_select2");e.length>0&&jQuery(e).each((function(e,t){var n=jQuery(this),i=n.find("option[value]:is([selected])"),a=n.find("option[value]"),r=[];a.each((function(){var e=jQuery(this);r.push({id:e.attr("value"),text:e.text()})}));var s=[];i.each((function(){var e=jQuery(this);s.push(e.val())}));var o=ajaxurl+"?action=pn_select2_category_data&nonce="+pn_setings.remote_nonce;n.select2({ajax:{url:o,delay:250,cache:!1},minimumInputLength:2,minimumResultsForSearch:50,dataAdapter:jQuery.fn.select2.amd.require("select2/data/extended-ajax"),defaultResults:r,multiple:!0,placeholder:"Select Category"}),n.val(s).trigger("change")}))}function pn_url_capture_manual(){"manual"==jQuery("#pn_url_capture").val()?jQuery("#pn_url_capture_manual").parent().parent().show():jQuery("#pn_url_capture_manual").parent().parent().hide()}jQuery(document).ready((function(e){var t="";let n="#pn_connect";if(n=localStorage.getItem("activeTab"),"undefined"===n&&(n="#pn_connect"),n&&(e(".pn-tabs").hide(),e(n).show(),e(".push-notification-tabs a").removeClass("nav-tab-active"),e('a[href="'+n+'"]').addClass("nav-tab-active"),localStorage.setItem("activeTab",n)),pn_setings.do_tour){var i,a="<h3>You are awesome for using Push Notification!</h3>";a+="<p>Do you want the latest on <b>Push Notification update</b> before others and some best resources on monetization in a single email? - Free just for users of Push Notification!</p>",a+='<style type="text/css">',a+=".wp-pointer-buttons{ padding:0; overflow: hidden; }",a+=".wp-pointer-content .button-secondary{  left: -25px;background: transparent;top: 5px; border: 0;position: relative; padding: 0; box-shadow: none;margin: 0;color: #0085ba;} .wp-pointer-content .button-primary{ display:none}  #pn_mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }",a+="</style>",a+='<div id="pn_mc_embed_signup">',a+='<form id="pushnotification-subscribe-newsletter-form" method="POST">',a+='<div id="pn_mc_embed_signup_scroll">',a+='<div class="pn-mc-field-group" style="    margin-left: 15px;    width: 195px;    float: left;">',a+='<input type="text" name="name" class="form-control" placeholder="Name" hidden value="'+pn_setings.current_user_name+'" style="display:none">',a+='<input type="text" value="'+pn_setings.current_user_email+'" name="email" class="form-control" placeholder="Email*"  style="      width: 180px;    padding: 6px 5px;">',a+='<input type="text" name="company" class="form-control" placeholder="Website" hidden style=" display:none; width: 168px; padding: 6px 5px;" value="'+pn_setings.get_home_url+'">',a+='<input type="hidden" name="ml-submit" value="1" />',a+="</div>",a+='<div id="mce-responses">',a+='<div class="response" id="mce-error-response" style="display:none"></div>',a+='<div class="response" id="mce-success-response" style="display:none"></div>',a+="</div>",a+='<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_a631df13442f19caede5a5baf_c9a71edce6" tabindex="-1" value=""></div>',a+='<input type="submit" value="Subscribe" name="subscribe" class="button mc-newsletter-sent" style=" background: #0085ba; border-color: #006799; padding: 0px 16px; text-shadow: 0 -1px 1px #006799,1px 0 1px #006799,0 1px 1px #006799,-1px 0 1px #006799; height: 30px; margin-top: 1px; color: #fff; box-shadow: 0 1px 0 #006799;">',a+="</div>",a+="</form>";var r={content:a+="</div>",position:{edge:"left",align:"left"}};i=function(){jQuery(pn_setings.displayID).pointer(r).pointer("open"),pn_setings.button2&&(jQuery("#pointer-close").after('<a id="pointer-primary" class="button-primary">'+pn_setings.button2+"</a>"),jQuery("#pointer-primary").click((function(){pn_setings.function_name})),jQuery("#pointer-close").click((function(){jQuery.post(pn_setings.ajax_url,{pointer:"pushnotification_subscribe_pointer",action:"dismiss-wp-pointer"})})))},(r=jQuery.extend(r,{buttons:function(e,t){return button=jQuery('<a id="pointer-close" class="button-secondary">'+pn_setings.button1+"</a>"),button_2=jQuery("#pointer-close.button"),button.bind("click.pointer",(function(){t.element.pointer("close")})),button_2.on("click",(function(){t.element.pointer("close")})),button},close:function(){jQuery.post(pn_setings.ajax_url,{pointer:"pushnotification_subscribe_pointer",action:"dismiss-wp-pointer"})},show:function(e,t){t.pointer.css({left:"170px",top:"160px"})}})).position&&r.position.defer_loading?jQuery(window).bind("load.wp-pointers",i):i()}function s(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}jQuery("#pushnotification-subscribe-newsletter-form").on("submit",(function(e){e.preventDefault();var t=jQuery(this),n=t.find('input[name="name"]').val(),i=t.find('input[name="email"]').val(),a=t.find('input[name="company"]').val();jQuery.post(pn_setings.ajax_url,{action:"pn_subscribe_newsletter",name:n,email:i,website:a,nonce:pn_setings.remote_nonce},(function(e){jQuery.post(pn_setings.ajax_url,{pointer:"pushnotification_subscribe_pointer",action:"dismiss-wp-pointer"},(function(){location.reload()}))}))})),jQuery("#user_auth_vadation").click((function(){var e=jQuery(this),t=jQuery("#user_auth_token_key").val().trim();if(""==t)return alert("Please enter valid token"),!1;e.addClass("button updating-message");var n=e.parents("fieldset").find(".resp_message");n.html(""),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{user_token:t,action:"pn_verify_user",nonce:pn_setings.remote_nonce},success:function(t){200==t.status?(n.html(t.message),n.css({color:"green"}),window.location.reload()):(n.html(t.message),n.css({color:"red"})),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery("#pn-refresh-apikey").click((function(){var e=jQuery(this);e.addClass("button updating-message");var t=e.parents("fieldset").find(".resp_message");t.html(""),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_refresh_user",nonce:pn_setings.remote_nonce},success:function(n){200==n.status?(t.html(n.message),t.css({color:"green"}),window.location.reload()):(t.html(n.message),t.css({color:"red"})),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery("#pn-remove-apikey").click((function(){var e=jQuery(this);e.addClass("button updating-message"),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_revoke_keys",nonce:pn_setings.remote_nonce},success:function(t){200==t.status?(e.after("&nbsp; "+t.message),window.location.reload()):e.after(t.message),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery("#grab-subscribers-data").click((function(){var e=jQuery(this);e.addClass("button updating-message"),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_subscribers_data",nonce:pn_setings.remote_nonce},success:function(t){200==t.status?(e.after("&nbsp; "+t.message),window.location.reload()):e.after(t.message),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery(".checkbox_operator").click((function(e){var t=0,n=jQuery(this).parent(".checkbox_wrapper").find(".checkbox_target");if(1==jQuery(this).prop("checked"))t=n.attr("data-truevalue");n.val(t)})),jQuery("#utm_tracking_checkbox").click((function(){1==jQuery(this).prop("checked")?jQuery("#utm_tracking_wrapper").show():jQuery("#utm_tracking_wrapper").hide()})),jQuery("#pn_push_on_category_checkbox").click((function(){1==jQuery(this).prop("checked")?(jQuery("#category_selector_wrapper").show(),jQuery(".js_category_selector_wrapper").show(),jQuery(".js_custom_category_selector_wrapper").show(),jQuery("#segment_category_selector_wrapper").show()):(jQuery("#category_selector_wrapper").hide(),jQuery(".js_category_selector_wrapper").hide(),jQuery(".js_custom_category_selector_wrapper").hide(),jQuery("#segment_category_selector_wrapper").hide())})),jQuery(".push-notification-tabs a").click((function(t){t.preventDefault();var n=jQuery(this).attr("link");jQuery(this).siblings().removeClass("nav-tab-active"),jQuery(this).addClass("nav-tab-active"),"pn_connect"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").hide(),jQuery("#pn_connect").show(),jQuery("#pn_campaings").hide()),"pn_dashboard"==n&&(jQuery("#pn_dashboard").show(),jQuery("#pn_wc_settings_section").show(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),"pn_segmentation"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_help").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_segmentation").show(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),"pn_notification_bell"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").show(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),"pn_campaings"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").show()),"pn_help"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").show(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),localStorage.setItem("activeTab",e(t.target).attr("href"))})),jQuery("#js_notification_button").click((function(t){t.preventDefault(),jQuery(".push-notification-tabs").find(".nav-tab-active").removeClass("nav-tab-active"),jQuery(".push-notification-tabs").find(".js_notification").addClass("nav-tab-active"),jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").show(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide(),localStorage.setItem("activeTab",e(t.target).attr("href"))})),jQuery(".pn_push_segment_category_checkbox").click((function(){var e;e=[],jQuery(".pn_push_segment_category_checkbox").each((function(t,n){if(1==jQuery(this).is(":checked")){var i=jQuery(this).val();e.push(i)}})),jQuery("#pn_push_segment_category_input").val(e)})),jQuery(".pn_help-send-query").on("click",(function(t){t.preventDefault(),e(".error_js").remove();var n=jQuery("#pn_query_email").val(),i=jQuery("#pn_help_query_message").val(),a=jQuery("#pn_help_query_customer").val();""!=jQuery.trim(i)&&a&&1==s(n)?jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"pn_send_query_message",customer_type:a,message:i,nonce:pn_setings.remote_nonce,email:n},success:function(e){"t"==e.status?(jQuery(".pn_help-query-success").show(),jQuery(".pn_help-query-error").hide()):(jQuery(".pn_help-query-success").hide(),jQuery(".pn_help-query-error").show())},error:function(e){console.log(e)}}):(""==jQuery.trim(n)?jQuery("#pn_query_email").after('<p  class="error_js" style="color:red;"> Pleas enter email<p/>'):0==s(n)&&jQuery("#pn_query_email").after('<p  class="error_js" style="color:red;">Please enter a valid email<p/>'),""==a&&jQuery("#pn_help_query_customer").after('<p  class="error_js" style="color:red;">Please select customer type<p/>'),""==jQuery.trim(i)&&jQuery("#pn_help_query_message").after('<p  class="error_js" style="color:red;">Please enter the message<p/>'))})),jQuery("body").on("click",".js_custom_pagination",(function(e){jQuery("#pn_cam_loading").css("display","block"),e.preventDefault();var t=jQuery(this).attr("page");jQuery.ajax({url:ajaxurl,method:"post",dataType:"html",data:{action:"pn_get_compaigns",page:t,nonce:pn_setings.remote_nonce},success:function(e){jQuery("#pn_cam_loading").css("display","none"),jQuery("#pn_campaings_custom_div").html(e)},error:function(e){jQuery("#pn_cam_loading").css("display","none"),console.log(e)}})})),jQuery(".upload_image_url").click((function(e){e.preventDefault();var t=wp.media({title:pn_setings.uploader_title,button:{text:pn_setings.uploader_button},multiple:!1,library:{type:"image"}}).on("select",(function(){var e=t.state().get("selection").first().toJSON();jQuery("#notification-imageurl").val(e.url),jQuery("#js_pn_banner").addClass("notification-banner"),jQuery(".notification-banner").css("background-image","url("+e.url+")")})).open()})),jQuery(".pn_not_icon").click((function(e){e.preventDefault();var t=wp.media({title:pn_setings.uploader_title,button:{text:pn_setings.uploader_button},multiple:!1,library:{type:"image"}}).on("select",(function(){var e=t.state().get("selection").first().toJSON();jQuery("#notification_icon").val(e.url)})).open()})),jQuery(".pn_pop_up_not_icon").click((function(e){e.preventDefault();var t=wp.media({title:pn_setings.uploader_title,button:{text:pn_setings.uploader_button},multiple:!1,library:{type:"image"}}).on("select",(function(){var e=t.state().get("selection").first().toJSON();jQuery("#notification_pop_up_icon").val(e.url)})).open()})),jQuery(".upload_icon_url").click((function(e){e.preventDefault();var t=wp.media({title:pn_setings.uploader_title,button:{text:pn_setings.uploader_button},multiple:!1,library:{type:"image"}}).on("select",(function(){var e=t.state().get("selection").first().toJSON();jQuery("#notification-iconurl").val(e.url),jQuery("#js_pn_icon").css("background-image","url("+e.url+")")})).open()})),jQuery("#notification-send-type").change((function(){console.log(jQuery(this).val()),"custom-select"==jQuery(this).val()?(jQuery("#notification-custom-select").parent().show(),jQuery("#notification-custom-upload").parent().hide(),jQuery("#notification-custom-page-subscribed").parent().hide()):"custom-upload"==jQuery(this).val()?(jQuery("#notification-custom-select").parent().hide(),jQuery("#notification-custom-upload").parent().show(),jQuery("#notification-custom-page-subscribed").parent().hide()):"custom-page-subscribed"==jQuery(this).val()?(jQuery("#notification-custom-select").parent().hide(),jQuery("#notification-custom-upload").parent().hide(),jQuery("#notification-custom-page-subscribed").parent().show()):(jQuery("#notification-custom-select").parent().hide(),jQuery("#notification-custom-upload").parent().hide(),jQuery("#notification-custom-page-subscribed").parent().hide())})),jQuery("#pn-send-custom-notification").click((function(){var e=jQuery(this),n=jQuery("#notification-title").val(),i=jQuery("#notification-link").val(),a=jQuery("#notification-imageurl").val(),r=jQuery("#notification-icon").val(),s=jQuery("#notification-message").val(),o=jQuery("#notification-send-type").val(),u=jQuery("#notification-custom-page-subscribed").val(),c=jQuery("#notification-custom-select").val(),l=(document.getElementById("notification-custom-upload"),"pn_send_notification"),p=jQuery("#notification-schedule").val(),_=null,d=null;if("yes"==p)_=jQuery("#notification-date").val(),d=jQuery("#notification-time").val();"custom-select"==o&&(t=c.join(",")),"custom-upload"==o&&(t=sessionStorage.getItem("pnTmpCsvData")),"custom-select"!=o&&"custom-upload"!=o&&"custom-page-subscribed"!=o||(l="campaign_for_individual_tokens"),e.addClass("button updating-message"),jQuery(".spinner").addClass("is-active"),jQuery(".js_error").html(""),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_send_notification",nonce:pn_setings.remote_nonce,title:n,link_url:i,image_url:a,icon_url:r,message:s,audience_token_id:t,audience_token_url:l,send_type:o,notification_schedule:p,notification_date:_,notification_time:d,page_subscribed:u},success:function(t){200==t.status?(jQuery(".pn-send-messageDiv").html("&nbsp; "+t.message).css({color:"green"}),jQuery("#notification-title").val(""),jQuery("#notification-link").val(""),jQuery("#notification-imageurl").val(""),jQuery("#notification-message").val(""),jQuery("#notification-date").val(),jQuery("#notification-time").val()):(jQuery.each(t.response,(function(e,t){"title"==e&&jQuery("#notification-title").after('<p class="js_error" style="color:red">The title field is required</p>'),"message"==e&&jQuery("#notification-message").after('<p class="js_error" style="color:red">The message field is required</p>'),"link_url"==e&&jQuery("#notification-link").after('<p class="js_error" style="color:red">The link url field is required</p>'),"notification_date"==e&&jQuery("#notification-date").after('<p class="js_error" style="color:red">The notification date field is required</p>'),"notification_time"==e&&jQuery("#notification-time").after('<p class="js_error" style="color:red">The notification time field is required</p>')})),jQuery(".pn-send-messageDiv").html("&nbsp; "+t.message).css({color:"red"})),e.removeClass("updating-message"),jQuery(".spinner").removeClass("is-active")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"}),jQuery(".spinner").removeClass("is-active")}})})),jQuery("#notification-custom-select").select2(),e(".my-color-field").wpColorPicker()})),document.querySelector("#notification-custom-upload")&&document.querySelector("#notification-custom-upload").addEventListener("change",(function(){const[e]=document.querySelector("#notification-custom-upload").files;var t=new FileReader;t.addEventListener("load",(()=>{user_ids=t.result,user_ids=JSON.stringify(pnCsvToArray(user_ids)),sessionStorage.setItem("pnTmpCsvData",user_ids),console.log(user_ids)}),!1),e&&t.readAsText(e)})),jQuery("#notification-schedule").change((function(){"yes"==jQuery(this).val()?jQuery("#notification-date").parent().show():jQuery("#notification-date").parent().hide()})),pn_for_wp_select2(),icon_url_text=jQuery("#notification-iconurl").val(),jQuery(".pn-notification-image").attr("src",icon_url_text),jQuery("#notification-title").keyup((function(){title_text=jQuery(this).val(),jQuery(".pn-notification-title").html(title_text)})),jQuery("#notification-message").keyup((function(){desc_text=jQuery(this).val(),jQuery(".pn-notification-description").html(desc_text)})),jQuery(".js_all").hide(),jQuery(".pn-clickable-image").click((function(){jQuery(".pn-image-container").find(".pn-clickable-image").removeClass("pn-clickable-image-selected"),jQuery(this).addClass("pn-clickable-image-selected"),template_type=jQuery(this).attr("notification_type"),jQuery(".js_all").hide(),jQuery("."+template_type).show(),icon_url=banner_url=jQuery("#js_notification_icon").attr("notification_icon"),banner_imageurl=jQuery("#notification-imageurl").val(),icon_imageurl=jQuery("#notification-iconurl").val(),banner_imageurl&&""!=banner_imageurl&&(banner_url=banner_imageurl),icon_imageurl&&""!=icon_imageurl&&(icon_url=icon_imageurl),"message-with-banner"==template_type?jQuery("#js_pn_banner").show():"message-with-icon"==template_type?jQuery("#js_pn_icon").show():"message-with-icon-and-banner"==template_type&&(jQuery("#js_pn_icon").show(),jQuery("#js_pn_banner").show())})),jQuery("#notification-templat").change((function(){template_type=jQuery(this).val(),jQuery(".js_all").hide(),jQuery("."+template_type).show(),icon_url=banner_url=jQuery("#js_notification_icon").attr("notification_icon"),banner_imageurl=jQuery("#notification-imageurl").val(),icon_imageurl=jQuery("#notification-iconurl").val(),banner_imageurl&&""!=banner_imageurl&&(banner_url=banner_imageurl),icon_imageurl&&""!=icon_imageurl&&(icon_url=icon_imageurl),"message-with-banner"==template_type?jQuery("#js_pn_banner").show():"message-with-icon"==template_type?jQuery("#js_pn_icon").show():"message-with-icon-and-banner"==template_type&&(jQuery("#js_pn_icon").show(),jQuery("#js_pn_banner").show())})),jQuery("#pn_campaings_custom_div").on("click",".pn_js_read_more",(function(){jQuery(this).parents("td").find(".full_text").show(),jQuery(this).parents("td").find(".less_text").hide()})),jQuery("#pn_campaings_custom_div").on("click",".pn_js_read_less",(function(){jQuery(this).parents("td").find(".full_text").hide(),jQuery(this).parents("td").find(".less_text").show()})),jQuery("#pn_url_capture").change((function(){pn_url_capture_manual()})),pn_url_capture_manual();