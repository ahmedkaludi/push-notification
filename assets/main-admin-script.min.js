function pnCsvToArray(e,t=","){const n=e.slice(0,e.indexOf("\n")).trim().split(t);return e.slice(e.indexOf("\n")+1).split("\n").map((function(e){const i=e.split(t);return n.reduce((function(e,t,n){return e[t]=i[n].trim(),e}),{})}))}jQuery(document).ready((function(e){var t="";let n="#pn_connect";if(n=localStorage.getItem("activeTab"),"undefined"===n&&(n="#pn_connect"),n&&(e(".pn-tabs").hide(),e(n).show(),e(".push-notification-tabs a").removeClass("nav-tab-active"),e('a[href="'+n+'"]').addClass("nav-tab-active"),localStorage.setItem("activeTab",n)),pn_setings.do_tour){var i,s="<h3>You are awesome for using Push Notification!</h3>";s+="<p>Do you want the latest on <b>Push Notification update</b> before others and some best resources on monetization in a single email? - Free just for users of Push Notification!</p>",s+='<style type="text/css">',s+=".wp-pointer-buttons{ padding:0; overflow: hidden; }",s+=".wp-pointer-content .button-secondary{  left: -25px;background: transparent;top: 5px; border: 0;position: relative; padding: 0; box-shadow: none;margin: 0;color: #0085ba;} .wp-pointer-content .button-primary{ display:none}  #pn_mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }",s+="</style>",s+='<div id="pn_mc_embed_signup">',s+='<form id="pushnotification-subscribe-newsletter-form" method="POST">',s+='<div id="pn_mc_embed_signup_scroll">',s+='<div class="pn-mc-field-group" style="    margin-left: 15px;    width: 195px;    float: left;">',s+='<input type="text" name="name" class="form-control" placeholder="Name" hidden value="'+pn_setings.current_user_name+'" style="display:none">',s+='<input type="text" value="'+pn_setings.current_user_email+'" name="email" class="form-control" placeholder="Email*"  style="      width: 180px;    padding: 6px 5px;">',s+='<input type="text" name="company" class="form-control" placeholder="Website" hidden style=" display:none; width: 168px; padding: 6px 5px;" value="'+pn_setings.get_home_url+'">',s+='<input type="hidden" name="ml-submit" value="1" />',s+="</div>",s+='<div id="mce-responses">',s+='<div class="response" id="mce-error-response" style="display:none"></div>',s+='<div class="response" id="mce-success-response" style="display:none"></div>',s+="</div>",s+='<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_a631df13442f19caede5a5baf_c9a71edce6" tabindex="-1" value=""></div>',s+='<input type="submit" value="Subscribe" name="subscribe" class="button mc-newsletter-sent" style=" background: #0085ba; border-color: #006799; padding: 0px 16px; text-shadow: 0 -1px 1px #006799,1px 0 1px #006799,0 1px 1px #006799,-1px 0 1px #006799; height: 30px; margin-top: 1px; color: #fff; box-shadow: 0 1px 0 #006799;">',s+="</div>",s+="</form>";var r={content:s+="</div>",position:{edge:"left",align:"left"}};i=function(){jQuery(pn_setings.displayID).pointer(r).pointer("open"),pn_setings.button2&&(jQuery("#pointer-close").after('<a id="pointer-primary" class="button-primary">'+pn_setings.button2+"</a>"),jQuery("#pointer-primary").click((function(){pn_setings.function_name})),jQuery("#pointer-close").click((function(){jQuery.post(pn_setings.ajax_url,{pointer:"pushnotification_subscribe_pointer",action:"dismiss-wp-pointer"})})))},(r=jQuery.extend(r,{buttons:function(e,t){return button=jQuery('<a id="pointer-close" class="button-secondary">'+pn_setings.button1+"</a>"),button_2=jQuery("#pointer-close.button"),button.bind("click.pointer",(function(){t.element.pointer("close")})),button_2.on("click",(function(){t.element.pointer("close")})),button},close:function(){jQuery.post(pn_setings.ajax_url,{pointer:"pushnotification_subscribe_pointer",action:"dismiss-wp-pointer"})},show:function(e,t){t.pointer.css({left:"170px",top:"160px"})}})).position&&r.position.defer_loading?jQuery(window).bind("load.wp-pointers",i):i()}function o(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}jQuery("#pushnotification-subscribe-newsletter-form").on("submit",(function(e){e.preventDefault();var t=jQuery(this),n=t.find('input[name="name"]').val(),i=t.find('input[name="email"]').val(),s=t.find('input[name="company"]').val();jQuery.post(pn_setings.ajax_url,{action:"pn_subscribe_newsletter",name:n,email:i,website:s,nonce:pn_setings.remote_nonce},(function(e){jQuery.post(pn_setings.ajax_url,{pointer:"pushnotification_subscribe_pointer",action:"dismiss-wp-pointer"},(function(){location.reload()}))}))})),jQuery("#user_auth_vadation").click((function(){var e=jQuery(this),t=jQuery("#user_auth_token_key").val().trim();if(""==t)return alert("Please enter valid token"),!1;e.addClass("button updating-message");var n=e.parents("fieldset").find(".resp_message");n.html(""),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{user_token:t,action:"pn_verify_user",nonce:pn_setings.remote_nonce},success:function(t){200==t.status?(n.html(t.message),n.css({color:"green"}),window.location.reload()):(n.html(t.message),n.css({color:"red"})),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery("#pn-refresh-apikey").click((function(){var e=jQuery(this);e.addClass("button updating-message");var t=e.parents("fieldset").find(".resp_message");t.html(""),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_refresh_user",nonce:pn_setings.remote_nonce},success:function(n){200==n.status?(t.html(n.message),t.css({color:"green"}),window.location.reload()):(t.html(n.message),t.css({color:"red"})),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery("#pn-remove-apikey").click((function(){var e=jQuery(this);e.addClass("button updating-message"),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_revoke_keys",nonce:pn_setings.remote_nonce},success:function(t){200==t.status?(e.after("&nbsp; "+t.message),window.location.reload()):e.after(t.message),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery("#grab-subscribers-data").click((function(){var e=jQuery(this);e.addClass("button updating-message"),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_subscribers_data",nonce:pn_setings.remote_nonce},success:function(t){200==t.status?(e.after("&nbsp; "+t.message),window.location.reload()):e.after(t.message),e.removeClass("updating-message")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"})}})})),jQuery(".checkbox_operator").click((function(e){var t=0,n=jQuery(this).parent(".checkbox_wrapper").find(".checkbox_target");if(1==jQuery(this).prop("checked"))t=n.attr("data-truevalue");n.val(t)})),jQuery("#utm_tracking_checkbox").click((function(){1==jQuery(this).prop("checked")?jQuery("#utm_tracking_wrapper").show():jQuery("#utm_tracking_wrapper").hide()})),jQuery("#pn_push_on_category_checkbox").click((function(){1==jQuery(this).prop("checked")?(jQuery("#category_selector_wrapper").show(),jQuery(".js_category_selector_wrapper").show()):(jQuery("#category_selector_wrapper").hide(),jQuery(".js_category_selector_wrapper").hide())})),jQuery("#pn_push_segment_on_category_checkbox").click((function(){1==jQuery(this).prop("checked")?jQuery("#segment_category_selector_wrapper").show():jQuery("#segment_category_selector_wrapper").hide()})),jQuery(".push-notification-tabs a").click((function(t){t.preventDefault();var n=jQuery(this).attr("link");jQuery(this).siblings().removeClass("nav-tab-active"),jQuery(this).addClass("nav-tab-active"),"pn_connect"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").hide(),jQuery("#pn_connect").show(),jQuery("#pn_campaings").hide()),"pn_dashboard"==n&&(jQuery("#pn_dashboard").show(),jQuery("#pn_wc_settings_section").show(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),"pn_segmentation"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_help").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_segmentation").show(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),"pn_notification_bell"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").show(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),"pn_campaings"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").show()),"pn_help"==n&&(jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").hide(),jQuery("#pn_help").show(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide()),localStorage.setItem("activeTab",e(t.target).attr("href"))})),jQuery("#js_notification_button").click((function(t){t.preventDefault(),jQuery(".push-notification-tabs").find(".nav-tab-active").removeClass("nav-tab-active"),jQuery(".push-notification-tabs").find(".js_notification").addClass("nav-tab-active"),jQuery("#pn_dashboard").hide(),jQuery("#pn_wc_settings_section").hide(),jQuery("#pn_segmentation").hide(),jQuery("#pn_notification_bell").show(),jQuery("#pn_help").hide(),jQuery("#pn_connect").hide(),jQuery("#pn_campaings").hide(),localStorage.setItem("activeTab",e(t.target).attr("href"))})),jQuery(".pn_push_segment_category_checkbox").click((function(){var e;e=[],jQuery(".pn_push_segment_category_checkbox").each((function(t,n){if(1==jQuery(this).is(":checked")){var i=jQuery(this).val();e.push(i)}})),jQuery("#pn_push_segment_category_input").val(e)})),jQuery(".pn_help-send-query").on("click",(function(t){t.preventDefault(),e(".error_js").remove();var n=jQuery("#pn_query_email").val(),i=jQuery("#pn_help_query_message").val(),s=jQuery("#pn_help_query_customer").val();""!=jQuery.trim(i)&&s&&1==o(n)?jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"pn_send_query_message",customer_type:s,message:i,nonce:pn_setings.remote_nonce,email:n},success:function(e){"t"==e.status?(jQuery(".pn_help-query-success").show(),jQuery(".pn_help-query-error").hide()):(jQuery(".pn_help-query-success").hide(),jQuery(".pn_help-query-error").show())},error:function(e){console.log(e)}}):(""==jQuery.trim(n)?jQuery("#pn_query_email").after('<p  class="error_js" style="color:red;"> Pleas enter email<p/>'):0==o(n)&&jQuery("#pn_query_email").after('<p  class="error_js" style="color:red;">Please enter a valid email<p/>'),""==s&&jQuery("#pn_help_query_customer").after('<p  class="error_js" style="color:red;">Please select customer type<p/>'),""==jQuery.trim(i)&&jQuery("#pn_help_query_message").after('<p  class="error_js" style="color:red;">Please enter the message<p/>'))})),jQuery("body").on("click",".js_custom_pagination",(function(e){e.preventDefault();var t=jQuery(this).attr("page");jQuery.ajax({url:ajaxurl,method:"post",dataType:"html",data:{action:"pn_get_compaigns",page:t,nonce:pn_setings.remote_nonce},success:function(e){jQuery("#pn_campaings_custom_div").html(e)},error:function(e){console.log(e)}})})),jQuery(".upload_image_url").click((function(e){e.preventDefault();var t=wp.media({title:pn_setings.uploader_title,button:{text:pn_setings.uploader_button},multiple:!1,library:{type:"image"}}).on("select",(function(){var e=t.state().get("selection").first().toJSON();jQuery("#notification-imageurl").val(e.url)})).open()})),jQuery(".upload_icon_url").click((function(e){e.preventDefault();var t=wp.media({title:pn_setings.uploader_title,button:{text:pn_setings.uploader_button},multiple:!1,library:{type:"image"}}).on("select",(function(){var e=t.state().get("selection").first().toJSON();jQuery("#notification-iconurl").val(e.url)})).open()})),jQuery("#notification-send-type").change((function(){console.log(jQuery(this).val()),"custom-select"==jQuery(this).val()?(jQuery("#notification-custom-select").parent().show(),jQuery("#notification-custom-upload").parent().hide()):"custom-upload"==jQuery(this).val()?(jQuery("#notification-custom-select").parent().hide(),jQuery("#notification-custom-upload").parent().show()):(jQuery("#notification-custom-select").parent().hide(),jQuery("#notification-custom-upload").parent().hide())})),jQuery("#pn-send-custom-notification").click((function(){var e=jQuery(this),n=jQuery("#notification-title").val(),i=jQuery("#notification-link").val(),s=jQuery("#notification-imageurl").val(),r=jQuery("#notification-icon").val(),o=jQuery("#notification-message").val(),a=jQuery("#notification-send-type").val(),c=jQuery("#notification-custom-select").val(),u=(document.getElementById("notification-custom-upload"),"pn_send_notification"),p=jQuery("#notification-schedule").val(),l=null,d=null;if("yes"==p)l=jQuery("#notification-date").val(),d=jQuery("#notification-time").val();"custom-select"==a&&(t=c.join(",")),"custom-select"!=a&&"custom-upload"!=a||(u="campaign_for_individual_tokens"),e.addClass("button updating-message"),jQuery(".spinner").addClass("is-active"),jQuery(".js_error").html(""),jQuery.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"pn_send_notification",nonce:pn_setings.remote_nonce,title:n,link_url:i,image_url:s,icon_url:r,message:o,audience_token_id:t,audience_token_url:u,send_type:a,notification_schedule:p,notification_date:l,notification_time:d},success:function(t){200==t.status?(jQuery(".pn-send-messageDiv").html("&nbsp; "+t.message).css({color:"green"}),jQuery("#notification-title").val(""),jQuery("#notification-link").val(""),jQuery("#notification-imageurl").val(""),jQuery("#notification-message").val(""),jQuery("#notification-date").val(),jQuery("#notification-time").val()):(jQuery.each(t.response,(function(e,t){"title"==e&&jQuery("#notification-title").after('<p class="js_error" style="color:red">The title field is required</p>'),"message"==e&&jQuery("#notification-message").after('<p class="js_error" style="color:red">The message field is required</p>'),"link_url"==e&&jQuery("#notification-link").after('<p class="js_error" style="color:red">The link url field is required</p>'),"notification_date"==e&&jQuery("#notification-date").after('<p class="js_error" style="color:red">The notification date field is required</p>'),"notification_time"==e&&jQuery("#notification-time").after('<p class="js_error" style="color:red">The notification time field is required</p>')})),jQuery(".pn-send-messageDiv").html("&nbsp; "+t.message).css({color:"red"})),e.removeClass("updating-message"),jQuery(".spinner").removeClass("is-active")},error:function(t){var n=e.parents("fieldset").find(".resp_message");n.html(t.responseJSON.message),n.css({color:"red"}),jQuery(".spinner").removeClass("is-active")}})})),jQuery("#notification-custom-select").select2()})),document.querySelector("#notification-custom-upload")&&document.querySelector("#notification-custom-upload").addEventListener("change",(function(){const[e]=document.querySelector("#notification-custom-upload").files;var t=new FileReader;t.addEventListener("load",(()=>{user_ids=t.result,user_ids=JSON.stringify(pnCsvToArray(user_ids)),sessionStorage.setItem("pnTmpCsvData",user_ids),console.log(user_ids)}),!1),e&&t.readAsText(e)})),jQuery("#notification-schedule").change((function(){"yes"==jQuery(this).val()?jQuery("#notification-date").parent().show():jQuery("#notification-date").parent().hide()}));